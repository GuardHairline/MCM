# AutoDL è·¨æ—¥æœŸé—®é¢˜è¯´æ˜ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æè¿°

æ‚¨æå‡ºäº†ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼šå¦‚æœå®éªŒè·¨è¶Šäº†ä¸¤ä¸ªæ—¥æœŸï¼Œæ˜¯å¦èƒ½æ­£ç¡®è¯»å–å‰ä¸€ä¸ªä»»åŠ¡çš„ `train_info.json` å’Œæ¨¡å‹ `.pt` æ–‡ä»¶æ¥å®ŒæˆæŒç»­å­¦ä¹ ï¼Ÿ

## ğŸ“Š é—®é¢˜åˆ†æ

### å½“å‰å®ç°ä¸­çš„æ—¥æœŸè·å–

ç³»ç»Ÿä¸­æœ‰**ä¸¤å¤„**è·å–æ—¥æœŸï¼š

#### 1. **é…ç½®ç”Ÿæˆæ—¶**ï¼ˆ`generate_autodl_configs.py`ï¼‰

```python
# ç¬¬32è¡Œ
from datetime import datetime
date_folder = datetime.now().strftime("%y%m%d")  # 251022
autodl_base = f"/root/autodl-tmp/checkpoints/{date_folder}"

# ç¬¬952-953è¡Œï¼ˆç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¸­ï¼‰
"output_model_path": f"{autodl_base}/model_xxx.pt",
"train_info_json": f"{autodl_base}/train_info_xxx.json",
```

**è·¯å¾„è¢«å†™å…¥é…ç½®æ–‡ä»¶**ï¼Œä¾‹å¦‚ï¼š
```json
{
    "global_params": {
        "output_model_path": "/root/autodl-tmp/checkpoints/251022/model_xxx.pt",
        "train_info_json": "/root/autodl-tmp/checkpoints/251022/train_info_xxx.json",
        "checkpoint_dir": "/root/autodl-tmp/checkpoints/251022"
    }
}
```

#### 2. **è„šæœ¬è¿è¡Œæ—¶**ï¼ˆ`run_autodl_experiments.sh`ï¼‰

```bash
# ç¬¬29è¡Œ
DATE_FOLDER=$(date +%y%m%d)  # è¿è¡Œæ—¶è·å–
AUTODL_STORAGE="/root/autodl-tmp/checkpoints/$DATE_FOLDER"
LOG_DIR="$AUTODL_STORAGE/log"
```

### ä¸¤ç§è·¨æ—¥æœŸåœºæ™¯

#### åœºæ™¯1ï¼šé…ç½®ç”Ÿæˆä¸è¿è¡Œä¸åœ¨åŒä¸€å¤© âš ï¸

```
æ—¶é—´è½´ï¼š
10æœˆ22æ—¥ 15:00 â”€â”
                 â”œâ”€ python scripts/generate_autodl_configs.py
                 â””â”€ ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œè·¯å¾„ä¸­åŒ…å«ï¼š251022

10æœˆ23æ—¥ 09:00 â”€â”
                 â”œâ”€ bash run_autodl_experiments.sh
                 â””â”€ è„šæœ¬è·å–æ—¥æœŸï¼š251023
```

**ä¼šå‘ç”Ÿä»€ä¹ˆ**ï¼š

| ç»„ä»¶ | ä½¿ç”¨çš„æ—¥æœŸ | è·¯å¾„ |
|-----|----------|------|
| é…ç½®æ–‡ä»¶ | `251022` | `/root/autodl-tmp/checkpoints/251022/` |
| è„šæœ¬æ—¥å¿—ç›®å½• | `251023` | `/root/autodl-tmp/checkpoints/251023/log/` |
| è®­ç»ƒè¿›ç¨‹ | `251022` | è¯»å–é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ `251022` |

**ç»“æœ**ï¼š
- âœ… **æŒç»­å­¦ä¹ æ­£å¸¸**ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ `251022` è·¯å¾„
- âœ… **train_info.json è¯»å†™æ­£å¸¸**ï¼šéƒ½åœ¨åŒä¸€ç›®å½•
- âœ… **æ¨¡å‹åŠ è½½æ­£å¸¸**ï¼šå‰ä¸€ä»»åŠ¡çš„æ¨¡å‹åœ¨åŒä¸€ç›®å½•
- âŒ **æ—¥å¿—ç›®å½•ä¸ä¸€è‡´**ï¼šè„šæœ¬åˆ›å»º `251023/log`ï¼Œä½†å®é™…ä»»åŠ¡æ—¥å¿—åœ¨ `251022/`

#### åœºæ™¯2ï¼šé•¿æ—¶é—´è¿è¡Œè·¨è¶Šåˆå¤œ âœ…

```
æ—¶é—´è½´ï¼š
10æœˆ22æ—¥ 23:50 â”€â”
                 â”œâ”€ bash run_autodl_experiments.sh
                 â”œâ”€ DATE_FOLDER=251022 (å¯åŠ¨æ—¶è·å–ä¸€æ¬¡)
                 â”œâ”€ å¼€å§‹ç¬¬1ä¸ªä»»åŠ¡...
                 â””â”€ ç¬¬1ä¸ªä»»åŠ¡å®Œæˆ

10æœˆ23æ—¥ 00:10 â”€â”
                 â”œâ”€ DATE_FOLDER ä»ç„¶æ˜¯ 251022 (ä¸ä¼šé‡æ–°è·å–)
                 â”œâ”€ å¼€å§‹ç¬¬2ä¸ªä»»åŠ¡...
                 â””â”€ è¯»å–ç¬¬1ä¸ªä»»åŠ¡çš„ train_info.json
```

**ç»“æœ**ï¼š
- âœ… **å®Œå…¨æ­£å¸¸**ï¼
- âœ… `DATE_FOLDER` åªåœ¨è„šæœ¬å¯åŠ¨æ—¶è·å–ä¸€æ¬¡ï¼Œä¹‹åä¸å˜
- âœ… é…ç½®æ–‡ä»¶è·¯å¾„å›ºå®šä¸º `251022`
- âœ… æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨åŒä¸€ç›®å½•è¯»å†™æ–‡ä»¶

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬ï¼ˆæ¨èï¼‰â­

æˆ‘å·²ç»åˆ›å»ºäº† `run_autodl_experiments_fixed.sh`ï¼Œæ–°å¢åŠŸèƒ½ï¼š

#### 1. **è‡ªåŠ¨æ£€æµ‹é…ç½®æ–‡ä»¶ä¸­çš„æ—¥æœŸ**

```bash
# ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–æ—¥æœŸï¼Œè€Œä¸æ˜¯ä½¿ç”¨å½“å‰æ—¥æœŸ
DETECTED_DATE=$(python3 -c "
import json
with open('first_config.json', 'r') as f:
    config = json.load(f)
    checkpoint_dir = config['global_params']['checkpoint_dir']
    # æå–æ—¥æœŸï¼š/root/autodl-tmp/checkpoints/251022 -> 251022
    date_folder = os.path.basename(checkpoint_dir)
    print(date_folder)
")
DATE_FOLDER="$DETECTED_DATE"
```

#### 2. **æ—¥æœŸä¸ä¸€è‡´è­¦å‘Š**

å¦‚æœæ£€æµ‹åˆ°é…ç½®æ–‡ä»¶æ—¥æœŸä¸å½“å‰æ—¥æœŸä¸ä¸€è‡´ï¼Œä¼šæ˜¾ç¤ºè­¦å‘Šï¼š

```
âš ï¸  ============================================================
âš ï¸  è­¦å‘Šï¼šæ—¥æœŸä¸ä¸€è‡´ï¼
âš ï¸  ============================================================
âš ï¸  é…ç½®æ–‡ä»¶æ—¥æœŸ: 251022
âš ï¸  å½“å‰ç³»ç»Ÿæ—¥æœŸ: 251023
âš ï¸  
âš ï¸  è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š
âš ï¸  1. é…ç½®æ–‡ä»¶æ˜¯ä¹‹å‰ç”Ÿæˆçš„
âš ï¸  2. ç³»ç»Ÿæ—¶é—´æœ‰è¯¯
âš ï¸  
âš ï¸  è„šæœ¬å°†ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„æ—¥æœŸ: 251022
âš ï¸  å¦‚éœ€é‡æ–°ç”Ÿæˆé…ç½®ï¼Œè¯·è¿è¡Œ:
âš ï¸    python scripts/generate_autodl_configs.py
âš ï¸  ============================================================

â³ 10ç§’åç»§ç»­æ‰§è¡Œ... (Ctrl+C å–æ¶ˆ)
```

#### 3. **æ‰‹åŠ¨æŒ‡å®šæ—¥æœŸ**

ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ—¥æœŸæ–‡ä»¶å¤¹ï¼š

```bash
bash run_autodl_experiments_fixed.sh --date 251022 --email your@email.com
```

### æ–¹æ¡ˆ2ï¼šå½“å¤©ç”Ÿæˆé…ç½®ï¼Œå½“å¤©è¿è¡Œï¼ˆç®€å•ï¼‰

**å·¥ä½œæµç¨‹**ï¼š
```bash
# 1. ç™»å½• AutoDL
ssh root@your-server

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate your_env

# 3. ç”Ÿæˆé…ç½®ï¼ˆä¼šä½¿ç”¨å½“å¤©æ—¥æœŸï¼‰
python scripts/generate_autodl_configs.py

# 4. ç«‹å³è¿è¡Œï¼ˆä½¿ç”¨åŒä¸€å¤©çš„æ—¥æœŸï¼‰
nohup bash scripts/configs/autodl_config/run_autodl_experiments.sh --email your@email.com > run.log 2>&1 &
```

**ä¼˜ç‚¹**ï¼šç®€å•ï¼Œä¸ä¼šæœ‰æ—¥æœŸä¸ä¸€è‡´é—®é¢˜

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨å›ºå®šçš„checkpointç›®å½•ï¼ˆæœ€å½»åº•ï¼‰

ä¿®æ”¹ `generate_autodl_configs.py`ï¼Œä¸ä½¿ç”¨æ—¥æœŸæ–‡ä»¶å¤¹ï¼š

```python
# å½“å‰æ–¹å¼ï¼ˆæœ‰æ—¥æœŸï¼‰
autodl_base = f"/root/autodl-tmp/checkpoints/{date_folder}"

# æ”¹ä¸ºå›ºå®šè·¯å¾„
autodl_base = "/root/autodl-tmp/checkpoints/current"

# æˆ–ä½¿ç”¨å®éªŒåç§°
autodl_base = f"/root/autodl-tmp/checkpoints/exp_{experiment_name}"
```

## ğŸ“‹ ä½¿ç”¨å»ºè®®

### åœºæ™¯Aï¼šç´§æ€¥è¿è¡Œï¼ˆä»Šå¤©ç”Ÿæˆä»Šå¤©è·‘ï¼‰

```bash
# ä¸€æ°”å‘µæˆ
python scripts/generate_autodl_configs.py && \
nohup bash scripts/configs/autodl_config/run_autodl_experiments.sh \
    --email your@email.com > run.log 2>&1 &
```

### åœºæ™¯Bï¼šæå‰å‡†å¤‡ï¼ˆæ˜¨å¤©ç”Ÿæˆä»Šå¤©è·‘ï¼‰â­

```bash
# ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬ï¼ˆä¼šè‡ªåŠ¨æ£€æµ‹é…ç½®æ–‡ä»¶æ—¥æœŸï¼‰
nohup bash scripts/configs/autodl_config/run_autodl_experiments_fixed.sh \
    --email your@email.com > run.log 2>&1 &
```

### åœºæ™¯Cï¼šé•¿æ—¶é—´è¿è¡Œï¼ˆå¯èƒ½è·¨åˆå¤œï¼‰

```bash
# ä½¿ç”¨ä»»ä½•è„šæœ¬éƒ½å¯ä»¥ï¼Œå› ä¸ºæ—¥æœŸåªåœ¨å¯åŠ¨æ—¶è·å–ä¸€æ¬¡
nohup bash scripts/configs/autodl_config/run_autodl_experiments.sh \
    --email your@email.com > run.log 2>&1 &
```

## ğŸ”§ æ£€æŸ¥ä¸éªŒè¯

### 1. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„

```bash
# æŸ¥çœ‹ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„checkpoint_dir
python3 -c "
import json
config_file = 'scripts/configs/autodl_config/autodl_seq1_twitter2015_deqa.json'
with open(config_file) as f:
    config = json.load(f)
    print('Checkpoint Dir:', config['global_params']['checkpoint_dir'])
    print('Train Info:', config['global_params']['train_info_json'])
    print('Model Path:', config['global_params']['output_model_path'])
"
```

### 2. è¿è¡Œæ—¶æ£€æŸ¥

```bash
# æŸ¥çœ‹è¿›åº¦æ–‡ä»¶
cat /root/autodl-tmp/checkpoints/251022/log/autodl_progress.json

# æ£€æŸ¥æ˜¯å¦æœ‰train_info.json
ls -lh /root/autodl-tmp/checkpoints/251022/train_info*.json

# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls -lh /root/autodl-tmp/checkpoints/251022/*.pt
```

### 3. éªŒè¯æŒç»­å­¦ä¹ 

```bash
# æŸ¥çœ‹train_info.jsonå†…å®¹
python3 -c "
import json
with open('/root/autodl-tmp/checkpoints/251022/train_info_xxx.json') as f:
    info = json.load(f)
    print(f'Total tasks: {len(info)}')
    for task, data in info.items():
        print(f'{task}: {len(data[\"val_history\"])} epochs')
"
```

## ğŸ“Œ æ€»ç»“

### âœ… æ”¾å¿ƒä½¿ç”¨çš„æƒ…å†µ

1. **åŒä¸€å¤©ç”Ÿæˆé…ç½®å¹¶è¿è¡Œ** - å®Œå…¨æ²¡é—®é¢˜
2. **è¿è¡Œè¿‡ç¨‹è·¨åˆå¤œ** - å®Œå…¨æ²¡é—®é¢˜ï¼ˆæ—¥æœŸåªè·å–ä¸€æ¬¡ï¼‰
3. **ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬** - è‡ªåŠ¨å¤„ç†æ—¥æœŸä¸ä¸€è‡´

### âš ï¸ éœ€è¦æ³¨æ„çš„æƒ…å†µ

1. **æå‰ç”Ÿæˆé…ç½®ï¼Œéš”å¤©è¿è¡Œ** - ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬ï¼Œæˆ–é‡æ–°ç”Ÿæˆé…ç½®
2. **æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶** - ç¡®ä¿æ‰€æœ‰è·¯å¾„ä¸­çš„æ—¥æœŸä¸€è‡´

### ğŸ¯ æœ€ä½³å®è·µ

```bash
# æ–¹å¼1ï¼šç°ç”Ÿæˆç°è¿è¡Œï¼ˆæœ€ç®€å•ï¼‰
python scripts/generate_autodl_configs.py && \
nohup bash scripts/configs/autodl_config/run_autodl_experiments.sh \
    --email your@email.com > run.log 2>&1 &

# æ–¹å¼2ï¼šä½¿ç”¨ä¿®å¤ç‰ˆï¼ˆæœ€ä¿é™©ï¼‰
nohup bash scripts/configs/autodl_config/run_autodl_experiments_fixed.sh \
    --email your@email.com > run.log 2>&1 &
```

## ğŸ”— ç›¸å…³æ–‡ä»¶

- âœ… åŸå§‹è„šæœ¬ï¼š`scripts/configs/autodl_config/run_autodl_experiments.sh`
- â­ ä¿®å¤è„šæœ¬ï¼š`scripts/configs/autodl_config/run_autodl_experiments_fixed.sh`
- ğŸ“ é…ç½®ç”Ÿæˆï¼š`scripts/generate_autodl_configs.py`
- ğŸ“ è®­ç»ƒè„šæœ¬ï¼š`scripts/train_with_zero_shot.py`

---

**ç»“è®º**ï¼šæ‚¨çš„æ‹…å¿ƒæ˜¯æœ‰é“ç†çš„ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä¼šæœ‰é—®é¢˜ã€‚ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬å¯ä»¥100%é¿å…è·¨æ—¥æœŸé—®é¢˜ï¼âœ…

